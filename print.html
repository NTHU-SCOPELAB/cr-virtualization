<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Virtualization Lab</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Virtualization Lab</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="exploring-virtual-machine-live-migration-performance-analysis-and-optimization"><a class="header" href="#exploring-virtual-machine-live-migration-performance-analysis-and-optimization">Exploring Virtual Machine Live Migration: Performance Analysis and Optimization</a></h1>
<h2 id="live-migration"><a class="header" href="#live-migration">Live Migration</a></h2>
<p>Live Migration is a crucial feature in virtualization technology that allows the transfer of a running virtual machine (VM) from one physical host to another without interrupting the VM's operation or services.
<img src="live_migration/../assets/2025-06-10-21-20-15.png" alt="" /></p>
<h2 id="the-architecture-we-want-to-simulate"><a class="header" href="#the-architecture-we-want-to-simulate">The architecture we want to simulate:</a></h2>
<img width="449" height="253" alt="image" src="https://github.com/user-attachments/assets/d4c4f8e9-0685-4556-b1df-8f2cc279c459" />
<h2 id="our-homework-architecture"><a class="header" href="#our-homework-architecture">Our Homework Architecture:</a></h2>
<p>Since not everyone will have 2 PCs available to run QEMU on them, we provided an alternative option:<br />
<img width="486" height="281" alt="image" src="https://github.com/user-attachments/assets/06c62b41-4dfe-48c7-8183-b4e3e82b49b5" /></p>
<ul>
<li>Note: VirtualBox now has native Apple Silicon support on Apple hardware with M-Series chips, but we haven't yet tested the nested virtualization feature, so this homework may not work out on your hardware by default.</li>
<li>If you still want to test that out, feel free to ask us through the discussion/email on eeclass.</li>
<li>Or you can use the PC room in C.L.Liu(EECS) 3F, we already have VirtualBox installed in there.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-environment"><a class="header" href="#setup-environment">Setup Environment</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ol>
<li>We strongly suggests that your computer have at least 8GB of RAM and 30GB+ of storage space.</li>
<li>First, use a hypervisor software to create two virtual machines on your computer.</li>
</ol>
<ul>
<li>If you’re using Linux : QEMU is recommended.</li>
<li>If you’re using Windows or MacOS : VMWare Workstation or VMWare Fusion are recommended.</li>
</ul>
<p>The download link for VMware's software can be elusive, so you might need to put in some effort to locate it.</p>
<ol start="3">
<li>
<p>Next, go to download Ubuntu-24.04 desktop version as your Guest OS. It’s about 5.9G.
You can grab it from here: <a href="https://free.nchc.org.tw/ubuntu-cd/24.04/">download link</a></p>
</li>
<li>
<p>Search for <a href="https://ubuntu.com/tutorials/how-to-run-ubuntu-desktop-on-a-virtual-machine-using-virtualbox#1-overview">detailed</a> <a href="https://ubuntu.com/tutorials/install-ubuntu-desktop#5-installation-setup">installation guide</a> if you don't know how to install Ubuntu yet.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vmware-workstation"><a class="header" href="#vmware-workstation">VMWare Workstation</a></h1>
<h3 id="1-assuming-youve-downloaded-the-vmware-workstation-installer-and-ubuntu-image-file"><a class="header" href="#1-assuming-youve-downloaded-the-vmware-workstation-installer-and-ubuntu-image-file">1. Assuming you've downloaded the VMWare Workstation installer and Ubuntu image file.</a></h3>
<h3 id="2-install-the-vmware-workstation"><a class="header" href="#2-install-the-vmware-workstation">2. Install the VMWare Workstation.</a></h3>
<h3 id="3-click-create-a-new-virtual-machine-and-proceed-with-the-creation-process"><a class="header" href="#3-click-create-a-new-virtual-machine-and-proceed-with-the-creation-process">3. Click "Create a New Virtual Machine" and proceed with the creation process.</a></h3>
<p><img src="live_migration/setup-environment/../../assets/2025-06-10-21-39-17.png" alt="" /></p>
<h3 id="4-use-the-ubuntu-image-youve-already-downloaded-use-the-version-you-downloaded-not-2004-in-the-image"><a class="header" href="#4-use-the-ubuntu-image-youve-already-downloaded-use-the-version-you-downloaded-not-2004-in-the-image">4. Use the Ubuntu image you've already downloaded. (Use the version you downloaded, not 20.04 in the image)</a></h3>
<p><img src="live_migration/setup-environment/../../assets/2025-06-10-21-39-43.png" alt="" /></p>
<h3 id="5-click-customize-hardware"><a class="header" href="#5-click-customize-hardware">5. Click "Customize Hardware..."</a></h3>
<p><img src="live_migration/setup-environment/../../assets/2025-06-10-21-39-59.png" alt="" /></p>
<h3 id="6-go-to-processors-tab-and-enable-virtualize-intel-vt-xept-or-amd-vrvi"><a class="header" href="#6-go-to-processors-tab-and-enable-virtualize-intel-vt-xept-or-amd-vrvi">6. Go to "Processors" tab and enable "Virtualize Intel VT-x/EPT or AMD-V/RVI".</a></h3>
<p><img src="live_migration/setup-environment/../../assets/2025-06-10-21-40-26.png" alt="" /></p>
<h3 id="7-repeat-the-above-steps-to-create-a-second-virtual-machine"><a class="header" href="#7-repeat-the-above-steps-to-create-a-second-virtual-machine">7. Repeat the above steps to create a second virtual machine.</a></h3>
<h3 id="8-boot-each-virtual-machine-and-complete-the-ubuntu-installation-process"><a class="header" href="#8-boot-each-virtual-machine-and-complete-the-ubuntu-installation-process">8. Boot each virtual machine and complete the Ubuntu installation process.</a></h3>
<h3 id="9-after-completing-the-installation-process-open-the-terminal-from-your-applications-menu"><a class="header" href="#9-after-completing-the-installation-process-open-the-terminal-from-your-applications-menu">9. After completing the installation process, open the terminal from your Applications menu.</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="virtualbox"><a class="header" href="#virtualbox">VirtualBox</a></h1>
<p>Using VirtualBox is similar to using VMWare Workstation, but you need to enable nested virtualization.</p>
<h2 id="use-gui-to-enable-nested-virtualization"><a class="header" href="#use-gui-to-enable-nested-virtualization">Use GUI to enable Nested Virtualization</a></h2>
<p><img src="live_migration/setup-environment/../../assets/2025-06-10-21-52-30.png" alt="" /></p>
<h2 id="use-command-line-to-enable-nested-virtualization"><a class="header" href="#use-command-line-to-enable-nested-virtualization">Use Command Line to Enable Nested Virtualization</a></h2>
<ol>
<li>Go to the directory of the VirtualBox you installed.</li>
<li>Open Command Prompt right in the place.</li>
<li>Enter the command below to enable nested virtualization:
<pre><code class="language-bash">.\VBoxManage.exe modifyvm "VM Name" --nested-hw-virt on
</code></pre>
Replace <code>"VM Name"</code> with the name of your virtual machine.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu"><a class="header" href="#qemu">QEMU</a></h1>
<h3 id="0-before-starting-setup-a-bridge-br0-for-qemu-to-bind-to-will-be-cleaned-up-naturally-after-a-reboot"><a class="header" href="#0-before-starting-setup-a-bridge-br0-for-qemu-to-bind-to-will-be-cleaned-up-naturally-after-a-reboot">0. Before starting, setup a bridge <code>br0</code> for QEMU to bind to: (will be cleaned up naturally after a reboot)</a></h3>
<img width="509" height="245" alt="image" src="https://github.com/user-attachments/assets/0b4d1dff-e3fd-4cb8-90d0-f305f261c78a" />  
<ul>
<li>Choose a subnet/IP that does not conflict with your usecase. For CIDR notation, see <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation">here</a>.</li>
</ul>
<pre><code class="language-bash">sudo ip link add br0 type bridge
sudo ip addr add 192.168.50.1/24 dev br0
sudo ip link set br0 up
</code></pre>
<ul>
<li>After running the command above, you can inspect your current network settings:</li>
</ul>
<pre><code class="language-bash">ip a
</code></pre>
<ul>
<li>Add a configuration file to enable qemu to automatically pick up your bridge configured above:</li>
</ul>
<pre><code class="language-bash">sudo su
mkdir -p /etc/qemu
echo "allow br0" &gt;&gt; /etc/qemu/bridge.conf
</code></pre>
<ul>
<li>For host to provide internet access to all instances attached to this bridge, issue the following command:</li>
</ul>
<pre><code class="language-bash">sudo sysctl -w net.ipv4.ip_forward=1
sudo iptables -A FORWARD -i br0 -o eth0 -j ACCEPT
sudo iptables -A FORWARD -i eth0 -o br0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -t nat -A POSTROUTING -o eth0 -s 192.168.50.0/24 -j MASQUERADE
</code></pre>
<ul>
<li>Note: swap out <code>eth0</code> for your network interface that provides internet access, you can check it by issuing the following command:</li>
</ul>
<pre><code class="language-bash">ip address
</code></pre>
<h3 id="1-first-create-the-disk-image-for-guest1"><a class="header" href="#1-first-create-the-disk-image-for-guest1">1. First, create the disk image for <code>guest1</code>.</a></h3>
<pre><code class="language-bash">qemu-img create -f qcow2 guest1.qcow2 20G
</code></pre>
<h3 id="2-run-guest1-and-complete-the-ubuntu-installation-process"><a class="header" href="#2-run-guest1-and-complete-the-ubuntu-installation-process">2. Run <code>guest1</code> and complete the Ubuntu installation process.</a></h3>
<pre><code class="language-bash">sudo qemu-system-x86_64 -cpu host -enable-kvm -m 4G -smp 1 \
    -drive if=virtio,format=qcow2,file=guest1.qcow2 \
    -nic bridge,br=br0,model=virtio-net-pci,mac=52:54:00:40:C9:01 \
    -boot d -cdrom &lt;your_ubuntu_img_file_path&gt;.iso \
    -vnc :1,password=on -monitor stdio
</code></pre>
<ul>
<li>In qemu console, type the following command to change the vnc password to the one you know:</li>
</ul>
<pre><code class="language-bash">(qemu) change vnc password
</code></pre>
<ul>
<li>After changing the password to the one you know, use any VNC viewer (e.g. : RealVNC, vncviewer) connect to (Your host IP):5901 (e.g. : 192.168.7.102:5901 or 127.0.0.1:5901), and complete the installation process.</li>
<li>After Ubuntu installation is complete, remove the <code>-boot d -cdrom &lt;your_img_file_path&gt;.iso</code> part from the above command and run <code>guest1</code> again.</li>
<li>If you want to reach internet or other device on this guest instance, you may want to manually configure your IP under the same subnet. (e.g. <code>192.168.50.2</code>, subnet mask: <code>255.255.255.0</code>, gateway: <code>192.168.50.1</code>)</li>
</ul>
<h3 id="3-repeat-the-same-steps-for-guest2"><a class="header" href="#3-repeat-the-same-steps-for-guest2">3. Repeat the same steps for <code>guest2</code></a></h3>
<pre><code class="language-bash">qemu-img create -f qcow2 guest2.qcow2 20G
sudo qemu-system-x86_64 -cpu host -enable-kvm -m 4G -smp 1 \
    -drive if=virtio,format=qcow2,file=guest2.qcow2 \
    -nic bridge,br=br0,model=virtio-net-pci,mac=52:54:00:40:C9:02 \
    -boot d -cdrom &lt;your_ubuntu_img_file_path&gt;.iso \
    -vnc :1,password=on -monitor stdio
</code></pre>
<ul>
<li>In qemu console, type the following command to change the vnc password to the one you know:</li>
</ul>
<pre><code class="language-bash">(qemu) change vnc password
</code></pre>
<ul>
<li>
<p>Using any VNC viewer (e.g. : RealVNC, vncviewer) connect to (Your host IP):5902 (e.g. : 192.168.7.102:5902 or 127.0.0.1:5902), and complete the installation process.</p>
</li>
<li>
<p>After Ubuntu installation is complete, remove the <code>-boot d -cdrom &lt;your_img_file_path&gt;.iso</code> part from the above command and run <code>guest2</code> again.</p>
</li>
<li>
<p>If you want to reach internet or other device on this guest instance, you may want to manually configure your IP under the same subnet. (e.g. <code>192.168.50.3</code>, subnet mask: <code>255.255.255.0</code>, gateway: <code>192.168.50.1</code>)</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="live-migration-1"><a class="header" href="#live-migration-1">Live Migration</a></h1>
<div class="warning">
    In this section, you need to demonstrate the above steps of the presentation through a screen recording, showing how you perform live migration on VMs using the framework we provided.
</div>
<ul>
<li>For more information, refer to the <a href="live_migration/assignment.html">Assignment section</a>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-1-setting-up-guest1"><a class="header" href="#task-1-setting-up-guest1">Task 1: Setting up guest1</a></h1>
<h3 id="1-enter-the-following-command-into-the-terminal"><a class="header" href="#1-enter-the-following-command-into-the-terminal">1. Enter the following command into the terminal:</a></h3>
<pre><code class="language-bash">sudo apt update -y
sudo apt install -y vim qemu-kvm nfs-kernel-server net-tools
</code></pre>
<h3 id="2-before-launching-qemu-on-the-first-guest-vm-obtain-the-ip-address-of-this-vm"><a class="header" href="#2-before-launching-qemu-on-the-first-guest-vm-obtain-the-ip-address-of-this-vm">2. Before launching QEMU on the first guest VM, obtain the IP address of this VM.</a></h3>
<pre><code class="language-bash">ip a
</code></pre>
<p>For example:
<img src="live_migration/live-migration/../../assets/2025-06-10-22-20-48.png" alt="" /></p>
<h3 id="3-create-a-qemu-image-file"><a class="header" href="#3-create-a-qemu-image-file">3. Create a QEMU image file:</a></h3>
<pre><code class="language-bash">qemu-img create -f qcow2 ubuntu.qcow2 10G
</code></pre>
<h3 id="4-create-a-new-directory-in-mnt-and-modify-its-ownership-and-permissions"><a class="header" href="#4-create-a-new-directory-in-mnt-and-modify-its-ownership-and-permissions">4. Create a new directory in <code>/mnt</code> and modify its ownership and permissions:</a></h3>
<pre><code class="language-bash">sudo mkdir -p /mnt/nfs
sudo chown nobody:nogroup /mnt/nfs
sudo chmod 777 /mnt/nfs
</code></pre>
<h3 id="5-move-the-qemu-image-file-you-just-created-into-the-new-directory"><a class="header" href="#5-move-the-qemu-image-file-you-just-created-into-the-new-directory">5. Move the QEMU image file you just created into the new directory:</a></h3>
<pre><code class="language-bash">mv ubuntu.qcow2 /mnt/nfs
</code></pre>
<h3 id="6-edit-the-file-at-etcexports-with-superuser-privileges"><a class="header" href="#6-edit-the-file-at-etcexports-with-superuser-privileges">6. Edit the file at <code>/etc/exports</code> with superuser privileges:</a></h3>
<pre><code class="language-bash">sudo vim /etc/exports
</code></pre>
<h3 id="7-add-the-following-line-to-the-end-of-the-exports-file-and-save-it"><a class="header" href="#7-add-the-following-line-to-the-end-of-the-exports-file-and-save-it">7. Add the following line to the end of the exports file and save it:</a></h3>
<pre><code class="language-bash">/mnt/nfs *(rw,sync,no_subtree_check,no_root_squash)
</code></pre>
<h3 id="8-return-to-the-terminal-and-enter-this-command-to-update-the-exports-file"><a class="header" href="#8-return-to-the-terminal-and-enter-this-command-to-update-the-exports-file">8. Return to the terminal and enter this command to update the exports file:</a></h3>
<pre><code class="language-bash">sudo exportfs -arv
</code></pre>
<h3 id="9-launch-qemu-to-simulate-a-running-process-on-the-virtual-machine"><a class="header" href="#9-launch-qemu-to-simulate-a-running-process-on-the-virtual-machine">9. Launch QEMU to simulate a running process on the virtual machine:</a></h3>
<pre><code class="language-bash">sudo qemu-system-x86_64 \
    -cpu host -enable-kvm -m 2G -smp 1 \
    -drive if=virtio,format=qcow2,file=/mnt/nfs/ubuntu.qcow2 \
    -monitor telnet:127.0.0.1:5500,server,nowait
</code></pre>
<p>A window similar to this will then appear:
<img src="live_migration/live-migration/../../assets/2025-06-10-22-25-39.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-2-setting-up-guest2"><a class="header" href="#task-2-setting-up-guest2">Task 2: Setting up guest2</a></h1>
<h3 id="1-enter-the-following-commands-into-the-terminal"><a class="header" href="#1-enter-the-following-commands-into-the-terminal">1. Enter the following commands into the terminal:</a></h3>
<pre><code class="language-bash">sudo apt update -y
sudo apt install -y qemu-kvm net-tools nfs-common
</code></pre>
<h3 id="2-before-launching-qemu-on-the-second-guest-vm-obtain-the-ip-address-of-this-vm"><a class="header" href="#2-before-launching-qemu-on-the-second-guest-vm-obtain-the-ip-address-of-this-vm">2. Before launching QEMU on the second guest VM, obtain the IP address of this VM.</a></h3>
<pre><code class="language-bash">ip a
</code></pre>
<p><img src="live_migration/live-migration/../../assets/2025-06-10-22-20-48.png" alt="" /></p>
<h3 id="3-enter-the-following-commands-into-the-terminal-to-mount-nfs-service"><a class="header" href="#3-enter-the-following-commands-into-the-terminal-to-mount-nfs-service">3. Enter the following commands into the terminal to mount NFS service:</a></h3>
<pre><code class="language-bash">sudo mkdir -p /mnt/nfs
sudo mount -t nfs &lt;replace_with_guest1_ip&gt;:/mnt/nfs /mnt/nfs
</code></pre>
<h3 id="4-luanch-qemu-on-the-second-vm-to-prepare-for-the-incoming-live-virtual-machine-migration"><a class="header" href="#4-luanch-qemu-on-the-second-vm-to-prepare-for-the-incoming-live-virtual-machine-migration">4. Luanch QEMU on the second VM to prepare for the incoming live virtual machine migration:</a></h3>
<pre><code class="language-bash">sudo qemu-system-x86_64 \
    -cpu host -enable-kvm -m 2G -smp 1 \
    -drive if=virtio,format=qcow2,file=/mnt/nfs/ubuntu.qcow2 \
    -incoming tcp:0:4400
</code></pre>
<p>A window similar to this will then appear:
<img src="live_migration/live-migration/../../assets/2025-06-10-22-51-51.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-3-migrate-from-guest1-to-guest2"><a class="header" href="#task-3-migrate-from-guest1-to-guest2">Task 3: Migrate from guest1 to guest2</a></h1>
<h3 id="1-return-the-first-guest-vm-open-a-new-terminal-tab-and-enter-the-following-command"><a class="header" href="#1-return-the-first-guest-vm-open-a-new-terminal-tab-and-enter-the-following-command">1. Return the first guest VM, open a new terminal tab, and enter the following command:</a></h3>
<pre><code class="language-bash">telnet 127.0.0.1 5500
</code></pre>
<h3 id="2-upon-the-new-command-prompt-issue-the-following-command-to-initiate-the-live-migration-process"><a class="header" href="#2-upon-the-new-command-prompt-issue-the-following-command-to-initiate-the-live-migration-process">2. Upon the new command prompt, issue the following command to initiate the live migration process:</a></h3>
<pre><code class="language-bash">migrate -d tcp:&lt;replace_with_guest2_ip&gt;:4400
</code></pre>
<h3 id="3-show-the-migration-info"><a class="header" href="#3-show-the-migration-info">3. Show the migration info:</a></h3>
<pre><code class="language-bash">info migrate
</code></pre>
<h3 id="4-the-screen-of-the-qemu-window-on-guest2-should-now-appear-as-follows"><a class="header" href="#4-the-screen-of-the-qemu-window-on-guest2-should-now-appear-as-follows">4. The screen of the QEMU window on <code>guest2</code> should now appear as follows:</a></h3>
<p><img src="live_migration/live-migration/../../assets/2025-06-10-22-57-56.png" alt="" /></p>
<p>This indicates that you've successfully completed the live migration of the virtual machine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="assignment"><a class="header" href="#assignment">Assignment</a></h1>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<h3 id="1-demo-40-points"><a class="header" href="#1-demo-40-points">1. Demo (40 points)</a></h3>
<ul>
<li>You need to demonstrate the above steps of the presentation through a screen recording, showing how you perform live migration on VMs using the framework we provided.</li>
<li>(only the live migration part is required, including the process of setting up 2 guests, but not the installation process)</li>
<li>Naming the record video file as <code>HW1_&lt;your_student_id&gt;.xxx</code>, e.g. <code>HW1_113062566.mov</code> or <code>HW1_113062566.mp4</code>.</li>
<li>The length of this video should not exceed <em><strong>30 minutes</strong></em>.</li>
<li>Upload the video to a cloud storage service and provide a link <em><strong>with viewing permission</strong></em>.
<ul>
<li>This can be done using YouTube, Google Drive, Dropbox, or any other similar service.</li>
</ul>
</li>
<li>Example:</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/0_64k7rplVk?si=ran08XJwlBHGmlFf" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
<h3 id="2-report-60-points"><a class="header" href="#2-report-60-points">2. Report (60 points)</a></h3>
<ul>
<li>You have to make a report of <em><strong>pdf format</strong></em> named <code>HW1_&lt;your_student_id&gt;.pdf</code>, e.g. <code>HW1_113062566.pdf</code>.</li>
<li>The report should include the following items:
<ul>
<li>A. Provide a detailed explanation of each instruction, including the purpose of individual arguments within the commands. <strong>(5 points)</strong></li>
<li>B. Show the performance testing results by <code>perf</code> with and without <code>-enable-kvm</code> on VM; furthermore compare among them and simply explain the results <strong>(10 points)</strong></li>
<li>C. Show the performance testing results by <code>iperf</code> with and without <code>virtio</code> on VM; furthermore compare among them and explain the results <strong>(10 points)</strong></li>
<li>D. Show the performance measurements by <code>perf</code> and <code>iperf</code> during the live migration is progressing; furthermore, simply describe your observations. <strong>(10 points)</strong></li>
<li>E. What is "live migration" and why we need it. <strong>(10 points)</strong></li>
<li>F. QEMU has a "fault tolerance" feature called <a href="https://wiki.qemu.org/Features/COLO">COLO</a>. We don’t ask you to utilize this feature in this assignment, but some questions you may answer :
<ul>
<li>What is fault-tolerance in virtualization technology and why we require it? <strong>(7.5 points)</strong></li>
<li>What are the relationships between live migration and fault-tolerance? <strong>(7.5 points)</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="submission"><a class="header" href="#submission">Submission</a></h2>
<p>Submit both the demo video link and the report to eeclass.</p>
<h2 id="deadline"><a class="header" href="#deadline">Deadline</a></h2>
<p>The deadline is set for October 26, 2025 23:59. Late submission is not allowed.</p>
<p>If you have any question, feel free to asking through eeclass or email.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="containerized-socket-communication-using-docker-and-kubernetes"><a class="header" href="#containerized-socket-communication-using-docker-and-kubernetes">Containerized Socket Communication: Using Docker and Kubernetes</a></h1>
<h3 id="this-assignment-has-two-phases"><a class="header" href="#this-assignment-has-two-phases">This assignment has two phases:</a></h3>
<ul>
<li>The first phase requires you to explore how to use Docker.</li>
<li>The second phase is to create services using Kubernetes. Each phase has several tasks.</li>
</ul>
<style>
img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    padding-top: 20px;
}
</style>
<img src="docker_kubernetes/../assets/k8slogo.svg" alt="Kubernetes Logo" height="100">
<img src="docker_kubernetes/../assets/docker-logo-blue.png" alt="Docker Logo" height="100">
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-environment-1"><a class="header" href="#setup-environment-1">Setup Environment</a></h1>
<h2 id="prequisite"><a class="header" href="#prequisite">Prequisite</a></h2>
<p>We have provided the required files for this assignment. Please download them from <a href="https://github.com/NTHU-SCOPELAB/cr-virtualization/releases/latest/download/hw2.zip">here</a>.</p>
<p>The required files are as follows (included within the downloaded <code>hw2.zip</code>):</p>
<pre><code>docker
  |-- server
  |     |-- Dockerfile
  |     |-- socket_server
  |     |-- socket_server_arm
  |
  |-- client
        |-- Dockerfile
        |-- socket_client.c

k8s
  |-- deployment.yaml
  |-- service.yaml
</code></pre>
<p>In addition, you must install the following programs on your computer:</p>
<ul>
<li><a href="https://docs.docker.com/get-started/get-docker/">Docker</a>: A tool that is used to automate the deployment of applications.</li>
<li><a href="https://minikube.sigs.k8s.io/docs/start/">Minikube</a>: Local Kubernetes, focusing on making it easy to learn for Kubernetes.</li>
<li><a href="https://kubernetes.io/docs/tasks/tools/#kubectl">Kubectl</a>: Command line tool for communicating with a control plane.</li>
</ul>
<p>There are different installation processes dependending on your operating system. You must have <em><strong>root permissions</strong></em> in your system.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<h3 id="in-this-task-you-are-required-to-create-two-docker-containers-one-container-runs-the-server-and-the-other-container-runs-the-client-allowing-the-client-to-communicate-with-the-server-and-transmit-messages"><a class="header" href="#in-this-task-you-are-required-to-create-two-docker-containers-one-container-runs-the-server-and-the-other-container-runs-the-client-allowing-the-client-to-communicate-with-the-server-and-transmit-messages">In this task, you are required to create two Docker containers. One container runs the server, and the other container runs the client, allowing the client to communicate with the server and transmit messages.</a></h3>
<p><img src="docker_kubernetes/../assets/2025-06-10-23-50-12.png" alt="" /></p>
<h3 id="once-you-have-installed-docker-and-downloaded-the-required-files-you-can-proceed-with-the-following-steps"><a class="header" href="#once-you-have-installed-docker-and-downloaded-the-required-files-you-can-proceed-with-the-following-steps">Once you have installed Docker and downloaded the required files, you can proceed with the following steps.</a></h3>
<h3 id="note-in-this-section-you-are-required-to-take-screenshots-of-the-command-output-to-include-in-your-report-when-you-see-something-like-this"><a class="header" href="#note-in-this-section-you-are-required-to-take-screenshots-of-the-command-output-to-include-in-your-report-when-you-see-something-like-this">Note: In this section, you are required to take screenshots of the command output to include in your report when you see something like this:</a></h3>
<div class="warning">
    <strong>Note:</strong> You need to include the screenshot of the command output above in your report. <strong>(5 points)</strong>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-1-building-the-images"><a class="header" href="#task-1-building-the-images">Task 1: Building the images</a></h1>
<h3 id="1-enter-the-client-folder-open-and-modify-the-please-assign-section-and-append-your-student-id-in-socket_clientc-as-shown-in-the-following-image"><a class="header" href="#1-enter-the-client-folder-open-and-modify-the-please-assign-section-and-append-your-student-id-in-socket_clientc-as-shown-in-the-following-image">1. Enter the client folder, open and modify the <code>PLEASE ASSIGN</code> section and append your student ID in <code>socket_client.c</code> as shown in the following image:</a></h3>
<img width="750" height="552" alt="image" src="https://github.com/user-attachments/assets/25129b2c-e607-4f17-86ad-62384b6372f2" />
<h3 id="2-build-the-image-with-the-dockerfile"><a class="header" href="#2-build-the-image-with-the-dockerfile">2. Build the image with the Dockerfile</a></h3>
<ul>
<li>If you're on arm64 architecture (e.g., Apple M1/M2), you'll have to modify the Dockerfile to use <code>socket_server_arm</code> instead.</li>
</ul>
<pre><code class="language-bash">cd path/to/server
docker build -t server-&lt;your_student_id&gt;
cd path/to/client
docker build -t client-&lt;your_student_id&gt;
</code></pre>
<p>You can use the following command to check images you've built:</p>
<pre><code class="language-bash">docker images
</code></pre>
<div class="warning">
You need to submit the screenshot of the list of your images. <strong>(5 points)</strong>
</div>
<p><img src="docker_kubernetes/docker/../../assets/2025-06-10-23-57-49.png" alt="" /></p>
<h3 id="3-launch-the-server-container-first-and-then-launch-the-client-container"><a class="header" href="#3-launch-the-server-container-first-and-then-launch-the-client-container">3. Launch the server container first, and then launch the client container:</a></h3>
<pre><code class="language-bash">docker run -it --rm --network host \
    --name server \
    server-&lt;your_student_id&gt;
docker run -it --rm --network host \
    --name client \
    client-&lt;your_student_id&gt;
</code></pre>
<p>The command <code>docker run</code> will create the container instance with the image and execute the container.</p>
<div class="warning">
You need to submit the screenshot of the output of the server and client containers. <strong>(5 points)</strong>
</div>
<p><img src="docker_kubernetes/docker/../../assets/2025-06-10-23-58-42.png" alt="" />
<img src="docker_kubernetes/docker/../../assets/2025-06-10-23-59-02.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-2-creating-bridge"><a class="header" href="#task-2-creating-bridge">Task 2: Creating bridge</a></h1>
<h3 id="in-this-task-you-are-required-to-create-a-bridge-to-connect-two-container-not-related-to-task-1"><a class="header" href="#in-this-task-you-are-required-to-create-a-bridge-to-connect-two-container-not-related-to-task-1">In this task, you are required to create a bridge to connect two container. (<em><strong>not related to Task 1</strong></em>)</a></h3>
<p><img src="docker_kubernetes/docker/../../assets/2025-06-11-00-04-36.png" alt="" /></p>
<h3 id="1-create-2-containers-using-the-following-commands"><a class="header" href="#1-create-2-containers-using-the-following-commands">1. Create 2 containers using the following commands:</a></h3>
<pre><code class="language-bash">docker container run -d --rm --name box1 busybox /bin/sh -c "while true; do sleep 3600; done"
</code></pre>
<pre><code class="language-bash">docker container run -d --rm --name box2 busybox /bin/sh -c "while true; do sleep 3600; done"
</code></pre>
<h3 id="2-create-a-network-bridge"><a class="header" href="#2-create-a-network-bridge">2. Create a network bridge:</a></h3>
<pre><code class="language-bash">docker network create box-bridge
</code></pre>
<h3 id="3-connecting-two-running-containers-to-the-network-bridge"><a class="header" href="#3-connecting-two-running-containers-to-the-network-bridge">3. Connecting two running containers to the network bridge:</a></h3>
<pre><code class="language-bash">docker network connect box-bridge box1
docker network connect box-bridge box2
</code></pre>
<h3 id="4-you-can-use-the-following-command-to-list-docker-networks"><a class="header" href="#4-you-can-use-the-following-command-to-list-docker-networks">4. You can use the following command to list docker networks:</a></h3>
<pre><code class="language-bash">docker network ls
</code></pre>
<div class="warning">
    <strong>Note:</strong> You need to include the screenshot of the command output above in your report. <strong>(5 points)</strong>
</div>
<p><img src="docker_kubernetes/docker/../../assets/2025-06-11-00-10-57.png" alt="" /></p>
<h3 id="5-you-can-inspect-more-about-the-details-of-the-box-bridge-network"><a class="header" href="#5-you-can-inspect-more-about-the-details-of-the-box-bridge-network">5. You can inspect more about the details of the <code>box-bridge</code> network:</a></h3>
<pre><code class="language-bash">docker network inspect box-bridge
</code></pre>
<div class="warning">
    <strong>Note:</strong> You need to include the screenshot of the command output above in your report. Points WILL BE DEDUCTED if any output text get cropped out. <strong>(5 points)</strong>
</div>
<p><img src="docker_kubernetes/docker/../../assets/2025-06-11-00-11-22.png" alt="" /></p>
<h3 id="6-log-into-box1-and-try-to-ping-box2"><a class="header" href="#6-log-into-box1-and-try-to-ping-box2">6. Log into <code>box1</code> and try to ping <code>box2</code>:</a></h3>
<pre><code class="language-bash">docker exec -it box1 sh
ping box2
</code></pre>
<div class="warning">
    <strong>Note:</strong> You need to include the screenshot of the command output above in your report. <strong>(5 points)</strong>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-3-creating-volume"><a class="header" href="#task-3-creating-volume">Task 3: Creating volume</a></h1>
<h3 id="1-you-need-to-use-docker-volume-create-to-create-a-volume-and-share-the-volume-between-two-containers"><a class="header" href="#1-you-need-to-use-docker-volume-create-to-create-a-volume-and-share-the-volume-between-two-containers">1. You need to use <code>docker volume create</code> to create a volume and share the volume between two containers.</a></h3>
<h3 id="2-you-need-to-use-bind-mounts-to-share-a-directory-between-two-containers"><a class="header" href="#2-you-need-to-use-bind-mounts-to-share-a-directory-between-two-containers">2. You need to use <code>bind mounts</code> to share a directory between two containers.</a></h3>
<div class="warning">
    <strong>Note:</strong> 1 and 2 are independent steps. Make sure you include the following into your report:
    <ul>
        <li>Briefly describe how you did it, and use screenshots to assist your explanation. <strong>(10 points)</strong></li>
        <li>What's the difference between these two steps? <strong>(5 points)</strong></li>
    </ul>
</div>
<h3 id="3-answer-the-following-questions-20-points"><a class="header" href="#3-answer-the-following-questions-20-points">3. Answer the following questions: (20 points)</a></h3>
<ul>
<li>Please explain the difference between Docker Container and Virtual Machine. *<strong>(10 points)</strong></li>
<li>Docker is more unsafe than virtual machine, please explain why and what's causing this issue. <em><strong>(10 points)</strong></em></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h1>
<h3 id="description"><a class="header" href="#description">Description</a></h3>
<p>In this task, you're required to create services using Kubernetes. We will use the image files from the previous phase to build our services and use the client container to communicate with the services.</p>
<h3 id="you-need-to-figure-out-the-following-concept-in-the-process"><a class="header" href="#you-need-to-figure-out-the-following-concept-in-the-process">You need to figure out the following concept in the process:</a></h3>
<ul>
<li>The relation between <code>Deployment</code>, <code>Replica Set</code> and <code>Pod</code>.</li>
<li>How pod management works in Kubernetes.</li>
<li>How to expose an application with the <code>Service</code>.</li>
<li>The difference between <code>ClusterIP</code>, <code>NodePort</code>, and <code>LoadBalancer</code>.</li>
</ul>
<p>Once you have:</p>
<ul>
<li>installed Docker</li>
<li>installed Minikube</li>
<li>installed Kubectl（Check the version to verify if it's installed)</li>
<li>and downloaded the required files</li>
</ul>
<p>you can proceed with the following steps.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="task-1-launching-k8s-and-deploy-our-containers"><a class="header" href="#task-1-launching-k8s-and-deploy-our-containers">Task 1: Launching K8s and deploy our containers</a></h1>
<h2 id="launch-your-kubernetes-cluster"><a class="header" href="#launch-your-kubernetes-cluster">Launch your Kubernetes cluster</a></h2>
<h3 id="1-start-the-kubernetes-cluster"><a class="header" href="#1-start-the-kubernetes-cluster">1. Start the Kubernetes cluster</a></h3>
<pre><code class="language-bash">minikube start
</code></pre>
<h3 id="2-get-the-instructions-to-point-your-docker-client-to-point-to-the-minikube-docker-daemon"><a class="header" href="#2-get-the-instructions-to-point-your-docker-client-to-point-to-the-minikube-docker-daemon">2. Get the instructions to point your docker client to point to the minikube docker daemon</a></h3>
<pre><code class="language-bash">minikube docker-env
</code></pre>
<h3 id="3-check-the-status-of-your-minikube-deployment"><a class="header" href="#3-check-the-status-of-your-minikube-deployment">3. Check the status of your minikube deployment</a></h3>
<pre><code class="language-bash">minikube status
</code></pre>
<img width="387" height="287" alt="image" src="https://github.com/user-attachments/assets/a66162be-f31d-41fb-a3c5-b93135f2848f" />
<h2 id="deploy-the-containers-into-the-cluster"><a class="header" href="#deploy-the-containers-into-the-cluster">Deploy the containers into the cluster</a></h2>
<h3 id="1-enter-the-k8s-folder-modify-the-files-as-required-and-input-the-following-command"><a class="header" href="#1-enter-the-k8s-folder-modify-the-files-as-required-and-input-the-following-command">1. Enter the k8s folder, modify the files as required and input the following command:</a></h3>
<pre><code class="language-bash">kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
</code></pre>
<h3 id="2-check-the-status-of-your-deployment"><a class="header" href="#2-check-the-status-of-your-deployment">2. Check the status of your deployment</a></h3>
<pre><code class="language-bash">kubectl get pods
kubectl get deployment
kubectl get services
</code></pre>
<div class="warning">
    <strong>Note:</strong> You need to include the screenshot of the command output above in your report. <strong>(10 points)</strong>
</div>
<p><img src="docker_kubernetes/kubernetes/../../assets/2025-06-11-12-37-16.png" alt="" /></p>
<h3 id="3-answer-the-following-questions-and-include-the-answers-in-your-report"><a class="header" href="#3-answer-the-following-questions-and-include-the-answers-in-your-report">3. Answer the following questions and include the answers in your report:</a></h3>
<ul>
<li>What is Kubernetes? Why do we need it? <em><strong>(5 points)</strong></em></li>
<li>Please explain the concepts of <code>Deployment</code>, <code>Service</code> and <code>Pod</code>. <em><strong>(5 points)</strong></em></li>
<li>Why k8s use pod to manipulate the application instead of the container. <em><strong>(5 points)</strong></em></li>
<li>What is <code>Replica Set</code> in Kubernetes? <em><strong>(5 points)</strong></em></li>
<li>Why can the client successfully communicate through port 30080 when the server is listening on port 8888? <em><strong>(10 points)</strong></em></li>
</ul>
<h2 id="optional-check-if-your-container-is-running-correctly-on-the-minikube"><a class="header" href="#optional-check-if-your-container-is-running-correctly-on-the-minikube">(Optional) Check if your container is running correctly on the minikube</a></h2>
<h3 id="1-get-the-ip-address-of-the-minikube"><a class="header" href="#1-get-the-ip-address-of-the-minikube">1. Get the ip address of the minikube:</a></h3>
<pre><code class="language-bash">minikube ip
</code></pre>
<h3 id="2-enter-the-client-folder-open-and-modify-the-please-assign-section-in-socket_clientc-replace--with-your-actual-student-id"><a class="header" href="#2-enter-the-client-folder-open-and-modify-the-please-assign-section-in-socket_clientc-replace--with-your-actual-student-id">2. Enter the client folder, open and modify the <code>PLEASE ASSIGN</code> section in <code>socket_client.c</code>. (Replace <your student ID> with your actual student ID):</a></h3>
<p><img src="docker_kubernetes/kubernetes/../../assets/2025-06-11-12-30-32.png" alt="" />
<img src="docker_kubernetes/kubernetes/../../assets/2025-06-11-12-30-45.png" alt="" /></p>
<h3 id="3-build-and-run-the-client-container"><a class="header" href="#3-build-and-run-the-client-container">3. Build and run the client container.</a></h3>
<h2 id="tear-down-the-deployed-services-and-minikube-cluster-after-you-finished-testing"><a class="header" href="#tear-down-the-deployed-services-and-minikube-cluster-after-you-finished-testing">Tear down the deployed services and minikube cluster after you finished testing:</a></h2>
<pre><code class="language-bash">kubectl delete -f service.yaml
kubectl delete -f deployment.yaml
minikube stop
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="helper-using-k8sgpt-to-help-debugging-your-issue"><a class="header" href="#helper-using-k8sgpt-to-help-debugging-your-issue">Helper: Using K8sGPT to help debugging your issue</a></h1>
<h2 id="0-prerequisite"><a class="header" href="#0-prerequisite">0. Prerequisite</a></h2>
<ul>
<li>You need to have a google account that have access to Google AI Studio.</li>
<li>You can use your local or other model provider as <a href="https://docs.k8sgpt.ai/reference/providers/backend/">backend</a>, but we'll use the free <code>gemini-2.5-flash</code> API from Google AI Studio as an example here.</li>
<li>If you care about privacy when running K8sGPT on your PC, you may want to <a href="https://docs.k8sgpt.ai/reference/guidelines/privacy/">check this out</a>.</li>
</ul>
<h2 id="1-install-k8sgpt"><a class="header" href="#1-install-k8sgpt">1. Install K8sGPT</a></h2>
<ul>
<li>Follow the official instructions <a href="https://docs.k8sgpt.ai/getting-started/installation/">here</a>.</li>
<li>Or download the binaries directly from the <a href="https://github.com/k8sgpt-ai/k8sgpt/releases/tag/latest">latest release</a>.</li>
</ul>
<h2 id="2-generate-api-key-from-google-ai-studio"><a class="header" href="#2-generate-api-key-from-google-ai-studio">2. Generate API Key from Google AI Studio</a></h2>
<h3 id="a-go-to-google-ai-studio-and-sign-in-with-your-google-account"><a class="header" href="#a-go-to-google-ai-studio-and-sign-in-with-your-google-account">a. Go to <a href="https://studio.google.com/">Google AI Studio</a> and sign in with your Google account.</a></h3>
<h3 id="b-click-on-get-api-key-button-on-the-bottom-left-corner"><a class="header" href="#b-click-on-get-api-key-button-on-the-bottom-left-corner">b. Click on "Get API Key" button on the bottom left corner.</a></h3>
<img width="865" height="552" alt="image" src="https://github.com/user-attachments/assets/952895d6-31d6-4222-b951-a972f55dda0b" />
<h3 id="c-create-api-key"><a class="header" href="#c-create-api-key">c. Create API Key</a></h3>
<img width="866" height="552" alt="image" src="https://github.com/user-attachments/assets/62558e2e-e5fb-42e6-9311-cb388eabfd8e" />
<img width="780" height="493" alt="image" src="https://github.com/user-attachments/assets/67d79e09-8462-4984-a0ba-ca0b06456b67" />
<img width="847" height="534" alt="image" src="https://github.com/user-attachments/assets/21ad748c-e6b1-45fe-9854-41be4bb09fbf" />
<img width="775" height="442" alt="image" src="https://github.com/user-attachments/assets/154b3340-f3eb-4ac1-af27-a60c8f30f1bb" />
<h3 id="d-copy-the-generated-api-key-and-save-it-somewhere-safe"><a class="header" href="#d-copy-the-generated-api-key-and-save-it-somewhere-safe">d. Copy the generated API key and save it somewhere safe.</a></h3>
<img width="864" height="552" alt="image" src="https://github.com/user-attachments/assets/8b2c8139-2388-474f-a189-7c1301993dec" />
<h2 id="3-setup-k8sgpt-to-use-gemini-api-as-backend"><a class="header" href="#3-setup-k8sgpt-to-use-gemini-api-as-backend">3. Setup K8sGPT to use Gemini API as backend</a></h2>
<ul>
<li>Replace <code>YOUR_API_KEY</code> with the API key you generated in step 2.</li>
</ul>
<pre><code class="language-bash">k8sgpt auth add --backend google --model gemini-2.5-flash --password "YOUR_API_KEY"
</code></pre>
<img width="1460" alt="image" src="https://github.com/user-attachments/assets/d31cc34f-3111-4fca-89cf-bca16ba60515" />
<h2 id="4-ask-k8sgpt-to-analyze-your-cluster-and-try-to-explain-the-issue"><a class="header" href="#4-ask-k8sgpt-to-analyze-your-cluster-and-try-to-explain-the-issue">4. Ask K8sGPT to analyze your cluster and try to explain the issue:</a></h2>
<pre><code class="language-bash">k8sgpt analyze --explain --backend google
</code></pre>
<ul>
<li>Result:</li>
</ul>
<pre><code>➜  k8s git:(main) ✗ k8sgpt analyze --explain --backend google                                                             
W1012 01:04:58.380993 3501705 warnings.go:70] v1 Endpoints is deprecated in v1.33+; use discovery.k8s.io/v1 EndpointSlice
100% |████████████████████████████████████████████████████████████████████████████████████| (13/13, 8 it/min)
AI Provider: google

0: Deployment default/socket-server()
- Error: Deployment default/socket-server has 1 replicas in spec but 2 replicas in status because status field is not updated yet after scaling and 0 replicas are available with status running
Error: Deployment spec (1) and status (2) mismatch, likely due to a delayed status update after scaling. No pods are currently running.
Solution: 1. Wait a moment; it often self-corrects. 2. If persistent, check `kubectl get pods -l app=socket-server` for pod status. 3. If pods are stuck, `kubectl describe pod &lt;pod-name&gt;` for events/errors.

1: ConfigMap default/kube-root-ca.crt()
- Error: ConfigMap kube-root-ca.crt is not used by any pods in the namespace
Error: ConfigMap 'kube-root-ca.crt' exists but no pods in this namespace are configured to use it. It's currently unused.
Solution: 1. If required, modify pod spec to mount it. 2. If not, delete it: `kubectl delete cm kube-root-ca.crt`.

2: ConfigMap kube-node-lease/kube-root-ca.crt()
- Error: ConfigMap kube-root-ca.crt is not used by any pods in the namespace
Error: ConfigMap 'kube-root-ca.crt' exists but no pods in this namespace are configured to use it. It's currently unused.
Solution: 1. If required, modify pod spec to mount it. 2. If not, delete it: `kubectl delete cm kube-root-ca.crt`.

3: ConfigMap kube-public/cluster-info()
- Error: ConfigMap cluster-info is not used by any pods in the namespace
Error: ConfigMap 'cluster-info' exists but no pods are currently configured to use it in the namespace.
Solution: 1. Verify if 'cluster-info' is still required. 2. If not, delete it: `kubectl delete configmap cluster-info`.

4: ConfigMap kube-public/kube-root-ca.crt()
- Error: ConfigMap kube-root-ca.crt is not used by any pods in the namespace
Error: ConfigMap 'kube-root-ca.crt' exists but no pods in this namespace are configured to use it. It's currently unused.
Solution: 1. If required, modify pod spec to mount it. 2. If not, delete it: `kubectl delete cm kube-root-ca.crt`.

5: ConfigMap kube-system/extension-apiserver-authentication()
- Error: ConfigMap extension-apiserver-authentication is not used by any pods in the namespace
Error: ConfigMap 'extension-apiserver-authentication' exists but no pods in the namespace are configured to use it.
Solution: 1. Confirm if this ConfigMap is truly needed. 2. If not, delete it: `kubectl delete cm extension-apiserver-authentication`.

6: ConfigMap kube-system/kube-apiserver-legacy-service-account-token-tracking()
- Error: ConfigMap kube-apiserver-legacy-service-account-token-tracking is not used by any pods in the namespace
Error: ConfigMap `kube-apiserver-legacy-service-account-token-tracking` exists but no pods use it. It's likely obsolete or misconfigured.
Solution:
1. Verify if ConfigMap is needed.
2. If not, delete it: `kubectl delete cm kube-apiserver-legacy-service-account-token-tracking -n &lt;ns&gt;`.
3. If needed, check pod specs.

7: ConfigMap kube-system/kube-root-ca.crt()
- Error: ConfigMap kube-root-ca.crt is not used by any pods in the namespace
Error: ConfigMap 'kube-root-ca.crt' exists but no pods in this namespace are configured to use it. It's currently unused.
Solution: 1. If required, modify pod spec to mount it. 2. If not, delete it: `kubectl delete cm kube-root-ca.crt`.

8: ConfigMap kube-system/kubeadm-config()
- Error: ConfigMap kubeadm-config is not used by any pods in the namespace
Error: The `kubeadm-config` ConfigMap exists but no pods are currently using it.
Solution: 1. Verify if it's still needed. 2. If not, delete it: `kubectl delete cm kubeadm-config -n kube-system`.

9: ConfigMap kube-system/kubelet-config()
- Error: ConfigMap kubelet-config is not used by any pods in the namespace
Error: The ConfigMap named 'kubelet-config' exists in the namespace but no running pods are currently configured to mount or reference it, making it an unused resource.
Solution: 1. Verify if 'kubelet-config' is still required. 2. If not, delete it: `kubectl delete cm kubelet-config`. 3. If needed, update relevant pod specs to mount it.

10: Service default/socket-server-service()
- Error: Service has not ready endpoints, pods: [Pod/socket-server-76b4f57897-7vtjl Pod/socket-server-7fdb5cb468-drlg6], expected 2
Error: The Service can't route traffic because its pods aren't ready or healthy.
Solution: 1. `kubectl get pods` for status. 2. `kubectl logs &lt;pod-name&gt;` for errors. 3. `kubectl describe pod &lt;pod-name&gt;` for events/readiness. 4. Verify container port matches Service targetPort.

11: Pod default/socket-server-76b4f57897-7vtjl(Deployment/socket-server)
- Error: Failed to apply default image tag "server-&lt;your student ID&gt;": couldn't parse image name "server-&lt;your student ID&gt;": invalid reference format: repository name (library/server-&lt;your student ID&gt;) must be lowercase
Error: Image repository names must be lowercase. Your image name `server-&lt;ID&gt;` contains uppercase characters, causing an invalid reference format.
Solution: 1. Change the image name `server-&lt;ID&gt;` to all lowercase (e.g., `server-&lt;id&gt;`).
2. Update your Kubernetes manifest (YAML) with the corrected image name.

12: Pod default/socket-server-7fdb5cb468-drlg6(Deployment/socket-server)
- Error: Container image "server-113062566" is not present with pull policy of Never
Error: Container image "server-113062566" isn't found on the node; its 'Never' pull policy prevents downloading.
Solution: 1. Ensure image is built/loaded onto the node. 2. Or, update pod spec's `imagePullPolicy` to `IfNotPresent` to allow pulling from a registry.
</code></pre>
<ul>
<li>Now you can start to look for hints to solve the issue, or feed this information to the LLM you use to provide better context to solve your problem.</li>
</ul>
<pre><code class="language-bash"># Before proceeding, make sure you have modified the deployment.yaml accordingly(socket-server container name).
# In docker/server, build the image inside minikube
minikube image build -t server-&lt;your student ID&gt; .

# In k8s, after patching the image name in deployment.yaml
kubectl delete -f service.yaml
kubectl delete -f deployment.yaml
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml

# Check if everything is working now
kubectl get all
</code></pre>
<img width="1323" alt="image" src="https://github.com/user-attachments/assets/4d71c69a-b586-492a-b454-09c53909b9a2" />
<div style="break-before: page; page-break-before: always;"></div><h1 id="assignment-1"><a class="header" href="#assignment-1">Assignment</a></h1>
<h2 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h2>
<h3 id="1-report-100-points"><a class="header" href="#1-report-100-points">1. Report (100 points)</a></h3>
<ul>
<li>You have to make a report of <em><strong>pdf format</strong></em> named <code>HW2_&lt;your_student_id&gt;.pdf</code>, e.g. <code>HW2_113062566.pdf</code>.</li>
<li>The report should include the answers to the questions mentioned in the description of this lab.</li>
</ul>
<h2 id="submission-1"><a class="header" href="#submission-1">Submission</a></h2>
<p>Submit the report to eeclass.</p>
<h2 id="deadline-1"><a class="header" href="#deadline-1">Deadline</a></h2>
<p>The deadline is set for November 17, 2025. Late submission is not allowed.</p>
<p>If you have any question, feel free to asking through eeclass or email.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
